# API Gateway

API Gateway built with Go Fiber for microservices architecture.

## Structure

```
api-gateway/
├── cmd/
│   └── gateway/
│       └── main.go          # Application entry point
├── internal/
│   ├── auth/                # JWT authentication
│   ├── config/              # Configuration management
│   ├── middleware/          # Custom middleware (auth, cors, logger)
│   ├── proxy/               # Proxy logic
│   └── routes/              # Route definitions
├── Dockerfile               # Docker configuration
├── go.mod                   # Go dependencies
└── .env.example             # Environment variables example
```

## Features

- ✅ JWT Token Validation (tokens generated by users-ms)
- ✅ Request proxying to microservices
- ✅ CORS support
- ✅ Request logging
- ✅ Error recovery
- ✅ Public and protected routes
- ✅ User context forwarding to services

## Routes

### Public Routes (No Auth)
- `GET /health` - Health check
- `POST /api/users/register` - User registration (users-ms)
- `POST /api/users/login` - User login (users-ms)
- `POST /api/users/refresh-token` - Refresh JWT token (users-ms)
- `POST /api/users/forgot-password` - Password recovery (users-ms)
- `GET /api/hotels` - List hotels
- `GET /api/hotels/:id` - Get hotel details

### Protected Routes (Auth Required)
- `GET /api/users/profile` - Get user profile
- `PUT /api/users/profile` - Update user profile
- `POST /api/users/logout` - Logout user
- `POST /api/hotels` - Create hotel (admin)
- `PUT /api/hotels/:id` - Update hotel (admin)
- `DELETE /api/hotels/:id` - Delete hotel (admin)
- `/api/reservations/*` - All reservation endpoints
- `/api/notifications/*` - All notification endpoints

## Authentication Flow

1. User registers/logs in via `/api/users/login` → **users-ms generates JWT**
2. Client includes JWT in `Authorization: Bearer <token>` header
3. API Gateway validates JWT and forwards request with user context headers:
   - `X-User-ID`
   - `X-User-Email`
   - `X-User-Role`
4. Microservices receive authenticated user info in headers

## Environment Variables

See `.env.example` for configuration options.

## Running Locally

```bash
go run cmd/gateway/main.go
```

## Running with Docker

```bash
docker-compose up -d api-gateway
```
